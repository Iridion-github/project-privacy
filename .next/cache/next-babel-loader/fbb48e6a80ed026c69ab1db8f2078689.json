{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useEffect, useState } from 'react';\nimport styles from '../styles/Home.module.css';\nimport { useLanguage, useLanguageUpdate } from '../context/siteLanguageContext'; //context\n\nimport { Row, Col, Card, Form, Button, ButtonGroup } from 'react-bootstrap';\nimport { Header } from '../components/layout/Header';\nimport { Navigation } from '../components/layout/Navbar';\nimport { Loading } from '../components/layout/Loading';\nimport { Footer } from '../components/layout/Footer';\nimport { PdfViewer } from '../components/fileViewers/pdf/PdfViewer';\nimport { AdvancedSearch } from '../components/archive/AdvancedSearch';\nimport { CustomAutoSuggest } from '../components/archive/ui/CustomAutoSuggest';\nexport default function archivio(props) {\n  var siteLanguage = useLanguage(); //context\n\n  var _useState = useState(\"\"),\n      searchInput = _useState[0],\n      setSearchInput = _useState[1];\n\n  var _useState2 = useState(false),\n      isAdvanced = _useState2[0],\n      setIsAdvanced = _useState2[1];\n\n  var _useState3 = useState(false),\n      searched = _useState3[0],\n      setSearched = _useState3[1];\n\n  var _useState4 = useState(false),\n      advancedSearched = _useState4[0],\n      setAdvancedSearched = _useState4[1];\n\n  var _useState5 = useState([]),\n      searchResult = _useState5[0],\n      setSearchResult = _useState5[1];\n\n  var _useState6 = useState(false),\n      loading = _useState6[0],\n      setLoading = _useState6[1];\n\n  var _useState7 = useState(null),\n      showPdfModal = _useState7[0],\n      setShowPdfModal = _useState7[1];\n\n  var _useState8 = useState(\"giurisprudenza\"),\n      shownTab = _useState8[0],\n      setShownTab = _useState8[1];\n\n  var handleChangeShownTab = function handleChangeShownTab(targetTab) {\n    setShownTab(targetTab);\n  };\n\n  var openPdfViewer = function openPdfViewer(path, buffer) {\n    path ? setShowPdfModal(path) : setShowPdfModal(buffer);\n  };\n\n  var closePdfViewer = function closePdfViewer() {\n    setShowPdfModal(null);\n  };\n\n  var handleSetSearchResult = function handleSetSearchResult(searchResBefore) {\n    setSearchResult(searchResBefore);\n  };\n\n  var openAdvancedSearch = function openAdvancedSearch() {\n    setIsAdvanced(true);\n  };\n\n  var closeAdvancedSearch = function closeAdvancedSearch() {\n    setIsAdvanced(false);\n  };\n\n  var handleSetSearched = function handleSetSearched(searchedString, advancedFilters) {\n    if (!advancedFilters) {\n      setSearched(searchedString);\n    } else {\n      setAdvancedSearched(advancedFilters);\n      if (searchedString && searchedString.length > 0) setSearched(searchedString);\n    }\n  };\n\n  var submitSearch = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(input) {\n      var resJson;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              setLoading(true);\n              _context2.next = 4;\n              return fetch(\"http://localhost:3000/api/archive/search?searchterms=\".concat(input), {\n                method: 'GET',\n                headers: {\n                  key: 'Access-Control-Allow-Origin',\n                  value: '*'\n                }\n              }).then(function (response) {\n                return response.json();\n              }).then( /*#__PURE__*/function () {\n                var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(response) {\n                  return _regeneratorRuntime.wrap(function _callee$(_context) {\n                    while (1) {\n                      switch (_context.prev = _context.next) {\n                        case 0:\n                          handleSetSearchResult(response.data.filteredDocs);\n                          handleSetSearched(searchInput);\n                          setLoading(false);\n\n                        case 3:\n                        case \"end\":\n                          return _context.stop();\n                      }\n                    }\n                  }, _callee);\n                }));\n\n                return function (_x2) {\n                  return _ref2.apply(this, arguments);\n                };\n              }());\n\n            case 4:\n              resJson = _context2.sent;\n              _context2.next = 10;\n              break;\n\n            case 7:\n              _context2.prev = 7;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.log(_context2.t0);\n\n            case 10:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 7]]);\n    }));\n\n    return function submitSearch(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleSubmit = function handleSubmit(event) {\n    event.preventDefault();\n    var cleanInput = searchInput.replace(/[^\\w\\s]/gi, '');\n    submitSearch(cleanInput);\n  };\n\n  useEffect(function () {//console.log(\"useEffect console.log:\")\n  });\n  return __jsx(\"div\", {\n    className: styles.container\n  }, __jsx(Header, {\n    title: siteLanguage === \"ita\" ? \"Archivio\" : \"Archive\"\n  }), __jsx(Navigation, null), loading && __jsx(Loading, null), __jsx(\"main\", {\n    className: styles.main\n  }, __jsx(Card, {\n    className: \"p-2 fixed-width-card\"\n  }, __jsx(Card.Img, {\n    variant: \"top\",\n    src: \"archiveImg.png\"\n  }), __jsx(ButtonGroup, {\n    className: \"mt-5 mb-3 w-100\"\n  }, __jsx(Button, {\n    block: true,\n    className: \"mt-0\",\n    variant: shownTab === \"giurisprudenza\" ? \"info\" : \"outline-info\",\n    onClick: function onClick() {\n      return handleChangeShownTab(\"giurisprudenza\");\n    }\n  }, __jsx(\"h4\", null, \"Giurisprudenza\")), __jsx(Button, {\n    block: true,\n    className: \"mt-0\",\n    variant: shownTab === \"normativa\" ? \"info\" : \"outline-info\",\n    onClick: function onClick() {\n      return handleChangeShownTab(\"normativa\");\n    }\n  }, __jsx(\"h4\", null, \"Normativa\")), __jsx(Button, {\n    block: true,\n    className: \"mt-0\",\n    variant: shownTab === \"noteedottrina\" ? \"info\" : \"outline-info\",\n    onClick: function onClick() {\n      return handleChangeShownTab(\"noteedottrina\");\n    }\n  }, __jsx(\"h4\", null, \"Note e Dottrina\")), __jsx(Button, {\n    block: true,\n    className: \"mt-0\",\n    variant: shownTab === \"formulari\" ? \"info\" : \"outline-info\",\n    onClick: function onClick() {\n      return handleChangeShownTab(\"formulari\");\n    }\n  }, __jsx(\"h4\", null, \"Formulari\"))), __jsx(Card.Body, null, __jsx(Card.Title, {\n    className: \"text-center\"\n  }, siteLanguage === \"ita\" ? \"Archivio\" : \"Archive\"), __jsx(Row, {\n    className: \"p-3 justify-content-center ml-0\"\n  }, __jsx(Form, {\n    onSubmit: function onSubmit(event) {\n      return handleSubmit(event);\n    },\n    inline: true,\n    className: \"w-100 p-0\"\n  }, __jsx(Form.Group, {\n    className: \"w-100 justify-content-center\"\n  }, __jsx(Col, {\n    md: 9,\n    className: \"text-right pl-0 pr-0\"\n  }, __jsx(Row, {\n    className: \"w-100\"\n  }, __jsx(Col, {\n    md: 11,\n    className: \"pl-0 pr-0\"\n  }, __jsx(Form.Control, {\n    size: \"lg\",\n    type: \"text\",\n    placeholder: siteLanguage === \"ita\" ? \"Cerca nell'Archivio Legislativo\" : \"Search in our Legislation Archive\",\n    value: searchInput,\n    onChange: function onChange(event) {\n      return setSearchInput(event.target.value);\n    },\n    className: \"inline-form-custom w-100\"\n  })), __jsx(Col, {\n    md: 1,\n    className: \"pl-0 pr-0\"\n  }, __jsx(Button, {\n    block: true,\n    variant: \"info\",\n    disabled: searchInput.length < 10,\n    type: \"submit\",\n    size: \"lg\",\n    className: \"\"\n  }, __jsx(\"i\", {\n    className: \"fas fa-search\"\n  }))))), __jsx(Col, {\n    md: 3,\n    className: \"pl-0 pr-0\"\n  }, __jsx(Button, {\n    variant: \"info\",\n    className: \"ml-1 w-100\",\n    size: \"lg\",\n    onClick: isAdvanced ? function () {\n      return closeAdvancedSearch();\n    } : function () {\n      return openAdvancedSearch();\n    }\n  }, __jsx(Row, {\n    className: \"m-0 w-100\"\n  }, __jsx(Col, {\n    md: 10,\n    className: \"pr-0 pl-0\"\n  }, __jsx(\"span\", {\n    className: \"kinda-small-text\"\n  }, \"Ricerca Avanzata\")), __jsx(Col, {\n    md: 2,\n    className: \"pr-0 pl-1 chevron-container\"\n  }, isAdvanced ? __jsx(\"i\", {\n    className: \"fas fa-chevron-up\"\n  }) : __jsx(\"i\", {\n    className: \"fas fa-chevron-down\"\n  })))))))), __jsx(Row, {\n    className: \"p-3 justify-content-center\"\n  }, isAdvanced && __jsx(AdvancedSearch, {\n    shownTab: shownTab,\n    loading: loading,\n    setLoading: setLoading,\n    searchInput: searchInput,\n    handleSetSearched: handleSetSearched,\n    handleSetSearchResult: handleSetSearchResult\n  })), (searched && searchResult && searchResult.length > 0 || advancedSearched) && __jsx(Row, {\n    className: \"mt-4 p-3 justify-content-center archive-result-container\"\n  }, searched && searchResult && searchResult.length > 0 && !advancedSearched && __jsx(React.Fragment, null, __jsx(Col, {\n    md: 12\n  }, __jsx(\"h4\", {\n    className: \"text-center\"\n  }, \"Nell'Archivio\", searchResult.length === 1 ? \" Ã¨ presente \" : \" sono presenti \", searchResult.length, searchResult.length === 1 ? \" Documento \" : \" Documenti \", searched && searchResult && searchResult.length > 0 && searchResult.length === 1 ? \" contenente\" : \" contenenti\", \": \")), __jsx(Col, {\n    md: 12\n  }, __jsx(\"p\", {\n    className: \"text-center\"\n  }, \"\\\"\", searched, \"\\\" \"))), advancedSearched && searchResult && searchResult.length > 0 && !searched && __jsx(Col, {\n    md: 12\n  }, __jsx(\"h4\", {\n    className: \"text-center\"\n  }, \"Nell'Archivio\", searchResult.length === 1 ? \" Ã¨ presente \" : \" sono presenti \", searchResult.length, searchResult.length === 1 ? \" Documento \" : \" Documenti \", searchResult.length === 1 ? \" che soddisfa \" : \" che soddisfano \", \"i filtri di ricerca.\")), __jsx(Col, {\n    md: 12\n  }, __jsx(\"ul\", null, searchResult.map(function (el, i) {\n    return __jsx(\"li\", {\n      key: i\n    }, __jsx(React.Fragment, null, el.filename, el.filename && el.filename.includes(\".pdf\") && //pdf files viewer btn\n    __jsx(Button, {\n      size: \"sm\",\n      variant: \"info\",\n      className: \"ml-1 py-0 px-1\",\n      onClick: function onClick() {\n        return openPdfViewer(el.relativepath);\n      }\n    }, __jsx(\"i\", {\n      className: \"fas fa-eye\"\n    })), el.filename && (el.filename.includes(\".docx\") || el.filename.includes(\".doc\")) && //docx files viewer btn\n    __jsx(Button, {\n      size: \"sm\",\n      variant: \"info\",\n      className: \"ml-1 py-0 px-1\",\n      onClick: function onClick() {\n        openPdfViewer(null, el.buffer);\n      }\n    }, __jsx(\"i\", {\n      className: \"fas fa-eye\"\n    })), __jsx(PdfViewer, {\n      path: el.relativepath,\n      buffer: el.buffer,\n      filename: el.filename,\n      show: showPdfModal === el.relativepath || showPdfModal === el.buffer,\n      onClose: closePdfViewer\n    })));\n  })))), searched && searchResult && searchResult.length === 0 && __jsx(Row, {\n    className: \"mt-4 p-3 justify-content-center archive-result-container\"\n  }, __jsx(\"h4\", null, \"Nessun documento contenente: \\\" \", searched, \" \\\"\"))), __jsx(Card.Footer, {\n    className: \"text-center\"\n  }, __jsx(\"small\", {\n    className: \"text-muted\"\n  }, siteLanguage === \"ita\" ? \"Archivio aggiornato al\" : \"Archive last updated\", \": 26/01/2020\")))), __jsx(Footer, null));\n}","map":null,"metadata":{},"sourceType":"module"}