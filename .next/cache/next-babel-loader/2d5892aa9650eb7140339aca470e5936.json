{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\nimport { useEffect, useState } from 'react';\nimport styles from '../styles/Home.module.css';\nimport { useLanguage, useLanguageUpdate } from '../context/siteLanguageContext'; //context\n\nimport { Row, Col, Card, Form, Button, ButtonGroup } from 'react-bootstrap';\nimport { Header } from '../components/layout/Header';\nimport { Navigation } from '../components/layout/Navbar';\nimport { Loading } from '../components/layout/Loading';\nimport { Footer } from '../components/layout/Footer';\nimport { PdfViewer } from '../components/fileViewers/pdf/PdfViewer';\nimport { AdvancedSearch } from '../components/archive/AdvancedSearch';\nimport { CustomAutoSuggest } from '../components/archive/ui/CustomAutoSuggest';\nexport default function archivio(props) {\n  const siteLanguage = useLanguage(); //context\n\n  const {\n    0: searchInput,\n    1: setSearchInput\n  } = useState(\"\");\n  const {\n    0: isAdvanced,\n    1: setIsAdvanced\n  } = useState(false);\n  const {\n    0: searched,\n    1: setSearched\n  } = useState(false);\n  const {\n    0: advancedSearched,\n    1: setAdvancedSearched\n  } = useState(false);\n  const {\n    0: searchResult,\n    1: setSearchResult\n  } = useState([]);\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false);\n  const {\n    0: showPdfModal,\n    1: setShowPdfModal\n  } = useState(null);\n  const {\n    0: shownTab,\n    1: setShownTab\n  } = useState(\"giurisprudenza\");\n\n  const handleChangeShownTab = targetTab => {\n    setShownTab(targetTab);\n  };\n\n  const openPdfViewer = (path, buffer) => {\n    path ? setShowPdfModal(path) : setShowPdfModal(buffer);\n  };\n\n  const closePdfViewer = () => {\n    setShowPdfModal(null);\n  };\n\n  const handleSetSearchResult = searchResBefore => {\n    setSearchResult(searchResBefore);\n  };\n\n  const openAdvancedSearch = () => {\n    setIsAdvanced(true);\n  };\n\n  const closeAdvancedSearch = () => {\n    setIsAdvanced(false);\n  };\n\n  const handleSetSearched = (searchedString, advancedFilters) => {\n    if (!advancedFilters) {\n      setSearched(searchedString);\n    } else {\n      setAdvancedSearched(advancedFilters);\n      if (searchedString && searchedString.length > 0) setSearched(searchedString);\n    }\n  };\n\n  const submitSearch = async input => {\n    //const apiUrl = \"http://\" + context.req.headers.host + \"/api/consultation\" url a seconda dell'ambiente\n    try {\n      setLoading(true);\n      const resJson = await fetch(`http://localhost:3000/api/archive/search?searchterms=${input}`, {\n        method: 'GET',\n        headers: {\n          key: 'Access-Control-Allow-Origin',\n          value: '*'\n        }\n      }).then(response => response.json()).then(async response => {\n        handleSetSearchResult(response.data.filteredDocs);\n        handleSetSearched(searchInput);\n        setLoading(false);\n      });\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const handleSubmit = event => {\n    event.preventDefault();\n    const cleanInput = searchInput.replace(/[^\\w\\s]/gi, '');\n    submitSearch(cleanInput);\n  };\n\n  useEffect(() => {//console.log(\"useEffect console.log:\")\n  });\n  return __jsx(\"div\", {\n    className: styles.container\n  }, __jsx(Header, {\n    title: siteLanguage === \"ita\" ? \"Archivio\" : \"Archive\"\n  }), __jsx(Navigation, null), loading && __jsx(Loading, null), __jsx(\"main\", {\n    className: styles.main\n  }, __jsx(Card, {\n    className: \"p-2 fixed-width-card\"\n  }, __jsx(Card.Img, {\n    variant: \"top\",\n    src: \"archiveImg.png\"\n  }), __jsx(ButtonGroup, {\n    className: \"mt-5 mb-3 w-100\"\n  }, __jsx(Button, {\n    block: true,\n    className: \"mt-0\",\n    variant: shownTab === \"giurisprudenza\" ? \"info\" : \"outline-info\",\n    onClick: () => handleChangeShownTab(\"giurisprudenza\")\n  }, __jsx(\"h4\", null, \"Giurisprudenza\")), __jsx(Button, {\n    block: true,\n    className: \"mt-0\",\n    variant: shownTab === \"normativa\" ? \"info\" : \"outline-info\",\n    onClick: () => handleChangeShownTab(\"normativa\")\n  }, __jsx(\"h4\", null, \"Normativa\")), __jsx(Button, {\n    block: true,\n    className: \"mt-0\",\n    variant: shownTab === \"noteedottrina\" ? \"info\" : \"outline-info\",\n    onClick: () => handleChangeShownTab(\"noteedottrina\")\n  }, __jsx(\"h4\", null, \"Note e Dottrina\")), __jsx(Button, {\n    block: true,\n    className: \"mt-0\",\n    variant: shownTab === \"formulari\" ? \"info\" : \"outline-info\",\n    onClick: () => handleChangeShownTab(\"formulari\")\n  }, __jsx(\"h4\", null, \"Formulari\"))), __jsx(Card.Body, null, __jsx(Card.Title, {\n    className: \"text-center\"\n  }, siteLanguage === \"ita\" ? \"Archivio\" : \"Archive\"), __jsx(Row, {\n    className: \"p-3 justify-content-center ml-0\"\n  }, __jsx(Form, {\n    onSubmit: event => handleSubmit(event),\n    inline: true,\n    className: \"w-100 p-0\"\n  }, __jsx(Form.Group, {\n    className: \"w-100 justify-content-center\"\n  }, __jsx(Col, {\n    md: 9,\n    className: \"text-right pl-0 pr-0\"\n  }, __jsx(Row, {\n    className: \"w-100\"\n  }, __jsx(Col, {\n    md: 11,\n    className: \"pl-0 pr-0\"\n  }, __jsx(Form.Control, {\n    size: \"lg\",\n    type: \"text\",\n    placeholder: siteLanguage === \"ita\" ? \"Cerca nell'Archivio Legislativo\" : \"Search in our Legislation Archive\",\n    value: searchInput,\n    onChange: event => setSearchInput(event.target.value),\n    className: \"inline-form-custom w-100\"\n  })), __jsx(Col, {\n    md: 1,\n    className: \"pl-0 pr-0\"\n  }, __jsx(Button, {\n    block: true,\n    variant: \"info\",\n    disabled: searchInput.length < 10,\n    type: \"submit\",\n    size: \"lg\",\n    className: \"\"\n  }, __jsx(\"i\", {\n    className: \"fas fa-search\"\n  }))))), __jsx(Col, {\n    md: 3,\n    className: \"pl-0 pr-0\"\n  }, __jsx(Button, {\n    variant: \"info\",\n    className: \"ml-1 w-100\",\n    size: \"lg\",\n    onClick: isAdvanced ? () => closeAdvancedSearch() : () => openAdvancedSearch()\n  }, __jsx(Row, {\n    className: \"m-0 w-100\"\n  }, __jsx(Col, {\n    md: 10,\n    className: \"pr-0 pl-0\"\n  }, __jsx(\"span\", {\n    className: \"kinda-small-text\"\n  }, \"Ricerca Avanzata\")), __jsx(Col, {\n    md: 2,\n    className: \"pr-0 pl-1 chevron-container\"\n  }, isAdvanced ? __jsx(\"i\", {\n    className: \"fas fa-chevron-up\"\n  }) : __jsx(\"i\", {\n    className: \"fas fa-chevron-down\"\n  })))))))), __jsx(Row, {\n    className: \"p-3 justify-content-center\"\n  }, isAdvanced && __jsx(AdvancedSearch, {\n    shownTab: shownTab,\n    loading: loading,\n    setLoading: setLoading,\n    searchInput: searchInput,\n    handleSetSearched: handleSetSearched,\n    handleSetSearchResult: handleSetSearchResult\n  })), (searched && searchResult && searchResult.length > 0 || advancedSearched) && __jsx(Row, {\n    className: \"mt-4 p-3 justify-content-center archive-result-container\"\n  }, searched && searchResult && searchResult.length > 0 && !advancedSearched && __jsx(React.Fragment, null, __jsx(Col, {\n    md: 12\n  }, __jsx(\"h4\", {\n    className: \"text-center\"\n  }, \"Nell'Archivio\", searchResult.length === 1 ? \" è presente \" : \" sono presenti \", searchResult.length, searchResult.length === 1 ? \" Documento \" : \" Documenti \", searched && searchResult && searchResult.length > 0 && searchResult.length === 1 ? \" contenente\" : \" contenenti\", \": \")), __jsx(Col, {\n    md: 12\n  }, __jsx(\"p\", {\n    className: \"text-center\"\n  }, \"\\\"\", searched, \"\\\" \"))), advancedSearched && searchResult && searchResult.length > 0 && !searched && __jsx(Col, {\n    md: 12\n  }, __jsx(\"h4\", {\n    className: \"text-center\"\n  }, \"Nell'Archivio\", searchResult.length === 1 ? \" è presente \" : \" sono presenti \", searchResult.length, searchResult.length === 1 ? \" Documento \" : \" Documenti \", searchResult.length === 1 ? \" che soddisfa \" : \" che soddisfano \", \"i filtri di ricerca.\")), __jsx(Col, {\n    md: 12\n  }, __jsx(\"ul\", null, searchResult.map((el, i) => __jsx(\"li\", {\n    key: i\n  }, __jsx(React.Fragment, null, el.filename, el.filename && el.filename.includes(\".pdf\") && //pdf files viewer btn\n  __jsx(Button, {\n    size: \"sm\",\n    variant: \"info\",\n    className: \"ml-1 py-0 px-1\",\n    onClick: () => openPdfViewer(el.relativepath)\n  }, __jsx(\"i\", {\n    className: \"fas fa-eye\"\n  })), el.filename && (el.filename.includes(\".docx\") || el.filename.includes(\".doc\")) && //docx files viewer btn\n  __jsx(Button, {\n    size: \"sm\",\n    variant: \"info\",\n    className: \"ml-1 py-0 px-1\",\n    onClick: () => {\n      openPdfViewer(null, el.buffer);\n    }\n  }, __jsx(\"i\", {\n    className: \"fas fa-eye\"\n  })), __jsx(PdfViewer, {\n    path: el.relativepath,\n    buffer: el.buffer,\n    filename: el.filename,\n    show: showPdfModal === el.relativepath || showPdfModal === el.buffer,\n    onClose: closePdfViewer\n  }))))))), searched && searchResult && searchResult.length === 0 && __jsx(Row, {\n    className: \"mt-4 p-3 justify-content-center archive-result-container\"\n  }, __jsx(\"h4\", null, \"Nessun documento contenente: \\\" \", searched, \" \\\"\"))), __jsx(Card.Footer, {\n    className: \"text-center\"\n  }, __jsx(\"small\", {\n    className: \"text-muted\"\n  }, siteLanguage === \"ita\" ? \"Archivio aggiornato al\" : \"Archive last updated\", \": 26/01/2020\")))), __jsx(Footer, null));\n}","map":null,"metadata":{},"sourceType":"module"}